{% extends "layout.html" %}

{% block content %}
<section class="dashboard-section" style="padding: 0; height: calc(100vh - var(--nav-height)); overflow: hidden;">
    <div class="dashboard-layout" style="display: grid; grid-template-columns: 1fr 380px; height: 100%; border-top: 1px solid var(--border-color);">
        
        <!-- Flight Schedule (Main) -->
        <main id="schedule-pane" style="display: flex; flex-direction: column; overflow: hidden; background: var(--bg-primary);">
            <div style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color); background: var(--bg-surface);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 class="mono" style="margin: 0; font-size: 0.875rem;">FLIGHT OPERATIONS SCHEDULE</h2>
                    <div class="mono" style="font-size: 0.625rem; color: var(--text-muted);">
                        SESSION: 2026.01.17 // CANADIAN AIRSPACE
                    </div>
                </div>
                <!-- Search Filter -->
                <div style="position: relative;">
                    <input type="text" id="flight-search" placeholder="FILTER BY ACID, TYPE, OR ROUTE..." 
                           style="width: 100%; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--text-primary); padding: 0.625rem 1rem; font-family: var(--font-mono); font-size: 0.625rem; outline: none;"
                           onkeyup="filterFlights()">
                </div>
            </div>

            <div style="flex: 1; overflow-y: auto;">
                <div class="feature-card" style="padding: 0; overflow: hidden; border: none;">
                    <table id="flight-table" style="width: 100%; border-collapse: collapse; font-family: var(--font-mono); font-size: 0.75rem;">
                        <thead style="position: sticky; top: 0; background: var(--bg-surface); z-index: 1;">
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <th style="text-align: left; padding: 1rem; color: var(--text-muted);">ACID</th>
                                <th style="text-align: left; padding: 1rem; color: var(--text-muted);">TYPE</th>
                                <th style="text-align: left; padding: 1rem; color: var(--text-muted);">ROUTE</th>
                                <th style="text-align: right; padding: 1rem; color: var(--text-muted);">ALT</th>
                                <th style="text-align: right; padding: 1rem; color: var(--text-muted);">SPEED</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for flight in flights %}
                            <tr class="flight-row" 
                                style="border-bottom: 1px solid var(--grid-line); cursor: pointer; transition: background 0.2s;"
                                hx-get="/flight/{{ flight.ACID }}" 
                                hx-target="#telemetry-pane-content"
                                onclick="selectFlightRow(this)">
                                <td style="padding: 1rem; font-weight: bold;">{{ flight.ACID }}</td>
                                <td style="padding: 1rem;"><span class="badge" style="font-size: 0.625rem;">{{ flight['Plane type'] }}</span></td>
                                <td style="padding: 1rem; color: var(--text-muted);">{{ flight['departure airport'] }} â†’ {{ flight['arrival airport'] }}</td>
                                <td style="padding: 1rem; text-align: right;">{{ flight.altitude }}</td>
                                <td style="padding: 1rem; text-align: right;">{{ flight['aircraft speed'] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Fixed Pagination Footer -->
            <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-surface); border-top: 1px solid var(--border-color);">
                {% if page > 1 %}
                <a href="/dashboard?page={{ page - 1 }}" class="btn" style="font-size: 0.625rem;">PREV</a>
                {% else %}
                <span class="btn disabled" style="font-size: 0.625rem; opacity: 0.3; cursor: not-allowed;">PREV</span>
                {% endif %}

                <span class="mono" style="font-size: 0.75rem;">PAGE {{ page }} OF {{ total_pages }}</span>

                {% if page < total_pages %}
                <a href="/dashboard?page={{ page + 1 }}" class="btn" style="font-size: 0.625rem;">NEXT</a>
                {% else %}
                <span class="btn disabled" style="font-size: 0.625rem; opacity: 0.3; cursor: not-allowed;">NEXT</span>
                {% endif %}
            </div>
        </main>

        <!-- Telemetry Detail -->
        <aside id="telemetry-pane" style="display: flex; flex-direction: column; border-left: 1px solid var(--border-color); background: var(--bg-surface); overflow-y: auto;">
            <div style="padding: 1rem; border-bottom: 1px solid var(--grid-line); background: rgba(var(--text-primary-rgb), 0.02);">
                <h3 class="mono" style="margin: 0; font-size: 0.75rem; letter-spacing: 0.1em;">PROFILE</h3>
            </div>
            <div id="telemetry-pane-content" style="padding: 1.5rem;">
                <div style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0.5; text-align: center; padding-top: 4rem;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 1rem;">
                        <path d="M17.8 19.2L16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/>
                    </svg>
                    <p class="mono" style="font-size: 0.75rem;">SELECT A FLIGHT FROM THE<br>SCHEDULE TO VIEW DETAILS</p>
                </div>
            </div>
        </aside>
    </div>

    <style>
        .flight-row:hover {
            background: rgba(var(--text-primary-rgb), 0.05);
        }
        .flight-row.selected {
            background: rgba(var(--text-primary-rgb), 0.08);
            box-shadow: inset 4px 0 0 var(--border-color);
        }
    </style>

    <script>
        function selectFlightRow(el) {
            document.querySelectorAll('.flight-row').forEach(row => {
                row.classList.remove('selected');
            });
            el.classList.add('selected');
        }

        function filterFlights() {
            const input = document.getElementById('flight-search');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('flight-table');
            const tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) {
                const row = tr[i];
                const text = row.textContent || row.innerText;
                if (text.toUpperCase().indexOf(filter) > -1) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            }
        }
    </script>
</section>
{% endblock %}
